<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hal 9 Ticket Booking</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    .stage {
      margin: 20px auto;
      width: 80%;
      background: #222;
      color: white;
      text-align: center;
      padding: 10px;
      border-radius: 6px;
      font-weight: bold;
    }

    .seating {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-top: 20px;
    }
    
.seat.price-80 {
  background-color: #d2691e; /* dark orange */
  color: white;
}

.seat.price-60 {
  background-color: #3a6ea5; /* medium blue */
  color: white;
}
    
    .row {
      display: flex;
      gap: 4px;
      perspective: 800px;
    }

    .seat {
      width: 26px;
      height: 26px;
      background-color: #ccc;
      border-radius: 4px;
      text-align: center;
      line-height: 26px;
      font-size: 10px;
      cursor: pointer;
      transition: 0.2s;
    }

    .seat.selected {
      background-color: #4caf50;
      color: white;
    }

    .seat.occupied {
      background-color: #888;
      cursor: not-allowed;
    }

    .curved .row {
      transform: perspective(600px) rotateX(12deg);
    }

    .row:nth-child(1) { transform: rotateZ(-8deg); }
    .row:nth-child(2) { transform: rotateZ(-6deg); }
    .row:nth-child(3) { transform: rotateZ(-4deg); }
    .row:nth-child(4) { transform: rotateZ(-2deg); }
    .row:nth-child(5) { transform: rotateZ(0deg); }
    .row:nth-child(6) { transform: rotateZ(2deg); }
    .row:nth-child(7) { transform: rotateZ(4deg); }
    .row:nth-child(8) { transform: rotateZ(6deg); }
    .row:nth-child(9) { transform: rotateZ(8deg); }

    form {
      background: white;
      padding: 20px;
      max-width: 500px;
      margin: 40px auto;
      border-radius: 8px;
    }

    label {
      display: block;
      margin-top: 10px;
    }

    input, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
    }

    .note {
      font-size: 0.9em;
      color: darkred;
      margin-top: 10px;
    }

    #selectedSeats, #totalPrice {
      margin-top: 10px;
      font-weight: bold;
    }

    @media (max-width: 600px) {
      .seat {
        width: 20px;
        height: 20px;
        font-size: 8px;
        line-height: 20px;
      }
    }
  </style>
</head>
<body>
  <h1>Hal 9 - Ticket Reservation</h1>
  <div style="display:flex; justify-content:center; gap:20px; margin-bottom:20px;">
  <div><div style="width:20px; height:20px; background:#d2691e; display:inline-block; border-radius:4px; margin-right:6px;"></div>Rows 1-2 (80 NIS)</div>
  <div><div style="width:20px; height:20px; background:#3a6ea5; display:inline-block; border-radius:4px; margin-right:6px;"></div>Rows 3-9 (60 NIS)</div>
  <div><div style="width:20px; height:20px; background:#888; display:inline-block; border-radius:4px; margin-right:6px;"></div>Occupied</div>
  <div><div style="width:20px; height:20px; background:#4caf50; display:inline-block; border-radius:4px; margin-right:6px;"></div>Selected</div>
</div>

  <div class="stage">STAGE</div>
  <div class="seating curved" id="seatingArea"></div>

  <form onsubmit="submitReservation(event)">
    <h2>Reserve Seats</h2>

    <label for="fullName">Full Name</label>
    <input type="text" id="fullName" name="Full Name" required>

    <label for="email">Email</label>
    <input type="email" id="email" name="Email" required>

    <div id="selectedSeats">Selected Seats: None</div>
    <div id="totalPrice">Total Price: 0 NIS</div>

    <input type="hidden" id="bookingCodeInput" name="Booking Code">

    <p class="note">This is only a reservation. Payment is at the venue.</p>
    <button type="submit">Submit Reservation</button>
  </form>

  <script>
    const seatingArea = document.getElementById("seatingArea");
    const selectedSeatsDisplay = document.getElementById("selectedSeats");
    const totalPriceDisplay = document.getElementById("totalPrice");
    const bookingCodeInput = document.getElementById("bookingCodeInput");

    let selectedSeats = [];
    let reservedSeats = [];

    fetch('reserved-seats.json')
      .then(res => res.json())
      .then(data => {
        reservedSeats = data.map(r => r.seat);
        renderSeats();
      })
      .catch(() => renderSeats());

function renderSeats() {
  seatingArea.innerHTML = ''; // clear before rendering
  for (let r = 1; r <= 9; r++) {
    const row = document.createElement("div");
    row.className = "row";
    for (let s = 1; s <= 24; s++) {
      const id = `R${r}S${s}`;
      const seat = document.createElement("div");
      seat.className = "seat";
      seat.dataset.id = id;
      seat.dataset.row = r;
      seat.textContent = s;

      // Add price class for colors
      if (r <= 2) {
        seat.classList.add("price-80");
      } else {
        seat.classList.add("price-60");
      }

      if (reservedSeats.includes(id)) {
        seat.classList.add("occupied");
      } else {
        seat.onclick = () => toggleSeat(seat);
      }

      row.appendChild(seat);
    }
    seatingArea.appendChild(row);
  }
}


    function toggleSeat(seat) {
      const id = seat.dataset.id;
      const index = selectedSeats.indexOf(id);
      if (index > -1) {
        selectedSeats.splice(index, 1);
        seat.classList.remove("selected");
      } else {
        selectedSeats.push(id);
        seat.classList.add("selected");
      }
      updateSummary();
    }

    function updateSummary() {
      const seatText = selectedSeats.join(", ") || "None";
      let total = 0;
      selectedSeats.forEach(id => {
        const row = parseInt(id.match(/R(\d+)/)[1]);
        total += row <= 2 ? 80 : 60;
      });
      selectedSeatsDisplay.textContent = `Selected Seats: ${seatText}`;
      totalPriceDisplay.textContent = `Total Price: ${total} NIS`;
    }

    function generateBookingCode() {
      return 'HAL9-' + Math.random().toString(36).substring(2, 8).toUpperCase();
    }

    async function submitReservation(event) {
      event.preventDefault();
      if (selectedSeats.length === 0) {
        alert("Please select at least one seat.");
        return;
      }

      const bookingCode = generateBookingCode();
      bookingCodeInput.value = bookingCode;

      const payload = {
        event_type: "new-reservation",
        client_payload: {
          seats: selectedSeats.join(","),
          code: bookingCode
        }
      };

      await fetch("https://api.github.com/repos/2MMisha/tickets/dispatches", {
        method: "POST",
        headers: {
          "Authorization": "Bearer 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", // Replace this
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      alert("Reservation submitted! Your booking code: " + bookingCode);
      location.reload();
    }
  </script>
</body>
</html>
